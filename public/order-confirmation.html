<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - Hyperlocal Marketplace</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">üè™ Local Marketplace</a>
                <nav>
                    <ul class="nav-links">
                        <li><a href="/">Home</a></li>
                        <li><a href="/orders.html">My Orders</a></li>
                    </ul>
                </nav>
                <div class="user-info">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div id="orderContent">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </main>

    <script src="/js/auth.js"></script>
    <script>
        // Check authentication
        if (!Auth.isAuthenticated()) {
            window.location.href = '/login.html';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            
            if (!orderId) {
                showAlert('Order not found', 'error');
                window.location.href = '/';
                return;
            }
            
            await loadOrderDetails(orderId);
        });

        async function loadOrderDetails(orderId) {
            const content = document.getElementById('orderContent');
            showLoading(content);
            
            try {
                const response = await Auth.apiRequest(`/api/orders/${orderId}`);
                
                if (!response.ok) {
                    throw new Error('Order not found');
                }
                
                const order = await response.json();
                
                content.innerHTML = `
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <div style="font-size: 4rem; color: #27ae60; margin-bottom: 1rem;">‚úÖ</div>
                        <h1 style="color: #27ae60; margin-bottom: 1rem;">Order Placed Successfully!</h1>
                        <p style="font-size: 1.1rem; color: #666;">Thank you for your order. We'll send you updates via email.</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 3rem;">
                        <!-- Order Details -->
                        <div>
                            <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                                <h3>Order Details</h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                                    <div>
                                        <strong>Order ID:</strong> ${order._id}
                                    </div>
                                    <div>
                                        <strong>Order Date:</strong> ${formatDate(order.createdAt)}
                                    </div>
                                    <div>
                                        <strong>Status:</strong> 
                                        <span style="padding: 0.25rem 0.5rem; background: #f39c12; color: white; border-radius: 4px; font-size: 0.8rem;">
                                            ${order.status.toUpperCase()}
                                        </span>
                                    </div>
                                    <div>
                                        <strong>Total Amount:</strong> ${formatPrice(order.totalAmount)}
                                    </div>
                                </div>
                                
                                <h4>Items Ordered</h4>
                                <div>
                                    ${order.items.map(item => `
                                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid #eee;">
                                            ${item.listingId && item.listingId.images && item.listingId.images.length > 0 
                                                ? `<img src="/uploads/${item.listingId.images[0]}" alt="${item.title}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">`
                                                : '<div style="width: 80px; height: 80px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">No Image</div>'
                                            }
                                            <div style="flex: 1;">
                                                <h5>${item.title}</h5>
                                                <p style="color: #666; margin: 0;">Seller: ${item.sellerId.name}</p>
                                                <p style="color: #666; margin: 0;">Quantity: ${item.quantity}</p>
                                            </div>
                                            <div style="font-weight: bold;">
                                                ${formatPrice(item.price * item.quantity)}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Shipping Address -->
                        <div>
                            <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                                <h3>Shipping Address</h3>
                                <div style="line-height: 1.6;">
                                    <strong>${order.shippingAddress.fullName}</strong><br>
                                    ${order.shippingAddress.address}<br>
                                    ${order.shippingAddress.city}, ${order.shippingAddress.state}<br>
                                    PIN: ${order.shippingAddress.pincode}<br>
                                    Phone: ${order.shippingAddress.phone}
                                </div>
                            </div>
                            
                            <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <h3>What's Next?</h3>
                                <ul style="line-height: 1.8; padding-left: 1.5rem;">
                                    <li>Sellers will be notified about your order</li>
                                    <li>You'll receive updates via email</li>
                                    <li>Track your order status in "My Orders"</li>
                                    <li>Contact sellers directly for any questions</li>
                                </ul>
                                
                                <div style="margin-top: 2rem;">
                                    <a href="/orders.html" class="btn btn-primary btn-block">View My Orders</a>
                                    <a href="/" class="btn btn-secondary btn-block" style="margin-top: 1rem;">Continue Shopping</a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading order:', error);
                content.innerHTML = `
                    <div class="alert alert-error">
                        <h3>Order Not Found</h3>
                        <p>The order you're looking for doesn't exist or you don't have permission to view it.</p>
                        <a href="/" class="btn btn-primary">Back to Home</a>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>